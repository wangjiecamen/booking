"use strict";const e=require("../../../../common/vendor.js"),o=require("./validator.js"),a=require("../../common/login-page.mixin.js");require("../../common/store.js"),require("../../common/password.js"),require("../../config.js");const s=e.Ls.importObject("uni-id-co"),t=e.Ls.importObject("branch"),r={mixins:[a.mixin],data:()=>({formData:{username:"",nickname:"",password:"",password2:"",captcha:"",department_id:""},rules:o.rules,focusUsername:!1,focusNickname:!1,focusPassword:!1,focusPassword2:!1,branchList:[],branchName:"",showPicker:!1}),onReady(){this.$refs.form.setRules(this.rules)},onShow(){},mounted(){this.getBranchList()},methods:{async getBranchList(){const{data:e}=await t.getBranchList();this.branchList=e.map((e=>({text:e.name,value:e._id})))},onConfirm(e){this.branchName=this.branchList[e.detail.index].text,console.log(this.branchName),this.formData.department_id=this.branchList[e.detail.index].value,this.showPicker=!1},submit(){if(""===this.formData.department_id)return e.index.showToast({title:"请选择所属部门",icon:"none",duration:3e3});this.$refs.form.validate().then((o=>4!=this.formData.captcha.length?(this.$refs.captcha.focusCaptchaInput=!0,e.index.showToast({title:"请输入验证码",icon:"none",duration:3e3})):this.needAgreements&&!this.agree?this.$refs.agreements.popup((()=>{this.submitForm(o)})):void this.submitForm(o))).catch((e=>{let o=e[0].key;o=o.replace(o[0],o[0].toUpperCase()),this["focus"+o]=!0}))},submitForm(e){s.registerUser(this.formData).then((e=>{this.loginSuccess(e)})).catch((e=>{console.log(e.message),this.$refs.captcha.getImageCaptcha()}))},navigateBack(){e.index.navigateBack()}}};if(!Array){(e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("van-icon")+e.resolveComponent("van-picker")+e.resolveComponent("van-popup")+e.resolveComponent("uni-captcha")+e.resolveComponent("uni-id-pages-agreements")+e.resolveComponent("uni-forms"))()}Math||((()=>"../../../uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni-captcha/components/uni-captcha/uni-captcha.js")+(()=>"../../components/uni-id-pages-agreements/uni-id-pages-agreements.js")+(()=>"../../../uni-forms/components/uni-forms/uni-forms.js"))();const n=e._export_sfc(r,[["render",function(o,a,s,t,r,n){return{a:e.o((e=>r.focusUsername=!1)),b:e.o((e=>r.formData.username=e)),c:e.p({inputBorder:!1,focus:r.focusUsername,placeholder:"请输入用户名",trim:"both",modelValue:r.formData.username}),d:e.p({name:"username",required:!0}),e:e.o((e=>r.focusNickname=!1)),f:e.o((e=>r.formData.nickname=e)),g:e.p({inputBorder:!1,focus:r.focusNickname,placeholder:"请输入用户昵称",trim:"both",modelValue:r.formData.nickname}),h:e.p({name:"nickname"}),i:e.o((e=>r.focusPassword=!1)),j:e.o((e=>r.formData.password=e)),k:e.p({inputBorder:!1,focus:r.focusPassword,maxlength:"20",placeholder:"请输入"+("weak"==o.config.passwordStrength?"6":"8")+"-16位密码",type:"password",trim:"both",modelValue:r.formData.password}),l:e.o((e=>r.formData.password=e)),m:e.p({name:"password",required:!0,modelValue:r.formData.password}),n:e.o((e=>r.focusPassword2=!1)),o:e.o((e=>r.formData.password2=e)),p:e.p({inputBorder:!1,focus:r.focusPassword2,placeholder:"再次输入密码",maxlength:"20",type:"password",trim:"both",modelValue:r.formData.password2}),q:e.o((e=>r.formData.password2=e)),r:e.p({name:"password2",required:!0,modelValue:r.formData.password2}),s:e.t(r.branchName),t:e.p({name:"arrow",color:"#ccc"}),v:e.o((e=>r.showPicker=!0)),w:e.o((e=>r.showPicker=!1)),x:e.o(n.onConfirm),y:e.p({showToolbar:!0,columns:r.branchList}),z:e.p({show:r.showPicker,round:!0,position:"bottom"}),A:e.sr("captcha","4ea04cbb-14,4ea04cbb-13"),B:e.o((e=>r.formData.captcha=e)),C:e.p({scene:"register",modelValue:r.formData.captcha}),D:e.sr("agreements","4ea04cbb-15,4ea04cbb-0"),E:e.p({scope:"register"}),F:e.o(((...e)=>n.submit&&n.submit(...e))),G:e.o(((...e)=>n.navigateBack&&n.navigateBack(...e))),H:e.sr("form","4ea04cbb-0"),I:e.p({value:r.formData,rules:r.rules,"validate-trigger":"submit","err-show-type":"toast"})}}]]);wx.createPage(n);
