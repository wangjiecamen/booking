"use strict";const e=require("../../../common/vendor.js");if(!Array){(e.resolveComponent("van-field")+e.resolveComponent("van-picker")+e.resolveComponent("van-popup")+e.resolveComponent("uni-captcha")+e.resolveComponent("van-cell")+e.resolveComponent("van-switch")+e.resolveComponent("van-cell-group")+e.resolveComponent("van-button"))()}Math;const a={__name:"edit",setup(a){const t=e.ref(),l=e.ref({status:0,username:"",nickname:"",password:"",password2:"",captcha:"",department_id:"",role:["user"]}),o=e.ref(""),n=e.ref(!1),i=e.ref([]);e.onLoad((async a=>{e.index.setNavigationBarTitle({title:a.id?"员工详情":"新增员工"}),await s(),a.id&&(l.value.uid=a.id,await c(),d(l.value.department_id))}));const s=async()=>{const{data:a}=await e.Ls.importObject("branch").getBranchList();i.value=a.map((e=>({text:e.name,value:e._id})))},u=(e,a)=>{l.value[e]=a},r=e=>{o.value=i.value[e.detail.index].text,l.value.department_id=i.value[e.detail.index].value,n.value=!1},d=e=>{o.value=i.value.find((a=>a.value===e)).text},c=async()=>{const{data:a}=await e.Ls.importObject("staff").getItem({_id:l.value.uid});console.log(a),l.value.username=a.username,l.value.nickname=a.nickname,l.value.status=a.status,l.value.department_id=a.department_id},v=async()=>""===l.value.department_id?e.index.showToast({title:"请选择所属部门",icon:"none",duration:3e3}):4!=l.value.captcha.length?(t.value.focusCaptchaInput=!0,e.index.showToast({title:"请输入验证码",icon:"none",duration:3e3})):(l.value.uid?await e.Ls.importObject("uni-id-co").updateUser(l.value):await e.Ls.importObject("uni-id-co").addUser(l.value),void e.index.navigateBack());return(a,s)=>({a:e.o((e=>u("username",e.detail))),b:e.p({label:"账号",value:l.value.username,placeholder:"请输入"}),c:e.o((e=>u("password",e.detail))),d:e.p({type:"password",label:"密码",value:l.value.password,placeholder:"请输入"}),e:e.o((e=>u("password2",e.detail))),f:e.p({type:"password",label:"密码",value:l.value.password2,placeholder:"请再次输入密码"}),g:e.o((e=>u("nickname",e.detail))),h:e.p({label:"昵称",value:l.value.nickname,placeholder:"请输入"}),i:e.p({value:o.value,isLink:!0,readonly:!0,label:"所属部门",placeholder:"选择部门"}),j:e.o((e=>n.value=!0)),k:e.o((e=>n.value=!1)),l:e.o(r),m:e.p({showToolbar:!0,columns:i.value}),n:e.p({show:n.value,round:!0,position:"bottom"}),o:e.sr(t,"4fbebcf8-9,4fbebcf8-8",{k:"captcha"}),p:e.o((e=>l.value.captcha=e)),q:e.p({scene:"register",modelValue:l.value.captcha}),r:e.p({title:"验证码"}),s:e.o((e=>u("status",e.detail))),t:e.p({size:"20",checked:l.value.status,activeValue:0,inactiveValue:1}),v:e.p({title:"账号状态"}),w:e.o(v),x:e.p({block:!0,round:!0,color:"#2196f3"})})}};wx.createPage(a);
